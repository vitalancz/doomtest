var Module=null;!function(e){function t(){return Array.prototype.reduce.call(arguments,w)}function n(){var e=Array.prototype.reduce.call(arguments,w);return e.emulator_arguments=c(e.emulatorStart,e.files,e.extra_dosbox_args),e.runner=m,e}function o(){var e=Array.prototype.reduce.call(arguments,w);return e.emulator_arguments=c(e.emulatorStart,e.files,e.extra_dosbox_args),e.runner=p,e}function i(){var e=Array.prototype.reduce.call(arguments,w);return e.emulator_arguments=u(e.muted,e.mame_driver,e.nativeResolution,e.sample_rate,e.peripheral,e.autoboot,e.extra_mame_args,e.keep_aspect,e.scale),e.runner=g,e}function r(){var e=Array.prototype.reduce.call(arguments,w);return e.fliplist&&r._create_fliplist_file(e.files,e.fliplist),e.emulator_arguments=f(e.emulatorStart,e.files,e.fliplist,e.extra_vice_args),e.runner=m,e}function a(){var e=Array.prototype.reduce.call(arguments,w);return e.runner=_,e}function l(){var e=Array.prototype.reduce.call(arguments,w);return e.emulator_arguments=["-c","/emulator/pce-"+e.pceModel+".cfg"],e.extra_pce_args&&e.extra_pce_args.length>0&&(e.emulator_arguments=e.emulator_arguments.concat(e.extra_pce_args)),e.runner=m,e}function s(){var e=Array.prototype.reduce.call(arguments,w);if(!e.emulatorStart)throw new Error("You must specify an autoLoad value in order to start this emulator. Try the name of the disk image.");return e.emulator_arguments=d(e.emulatorStart,e.files,e.extra_np2_args),e.runner=h,e}t.canvas=function(e){return{canvas:e instanceof Element?e:document.getElementById(e)}},t.emulatorJS=function(e){return{emulatorJS:e}},t.emulatorWASM=function(e){return{emulatorWASM:e}},t.locateAdditionalEmulatorJS=function(e){return{locateAdditionalJS:e}},t.fileSystemKey=function(e){return{fileSystemKey:e}},t.nativeResolution=function(e,t){if("number"!=typeof e||"number"!=typeof t)throw new Error("Width and height must be numbers");return{nativeResolution:{width:Math.floor(e),height:Math.floor(t)}}},t.aspectRatio=function(e){if("number"!=typeof e)throw new Error("Aspect ratio must be a number");return{aspectRatio:e}},t.scale=function(e){return{scale:e}},t.sampleRate=function(e){return{sample_rate:e}},t.muted=function(e){return{muted:e}},t.mountZip=function(e,t){return{files:[{drive:e,mountpoint:"/"+e,file:t}]}},t.mountFile=function(e,t){return{files:[{mountpoint:e,file:t}]}},t.fetchFile=function(e,t){return{title:e,url:t,optional:!1}},t.fetchOptionalFile=function(e,t){return{title:e,url:t,optional:!0}},t.localFile=function(e,t){return{title:e,data:t}},n.__proto__=t,n.startExe=function(e){return{emulatorStart:e}},n.extraArgs=function(e){return{extra_dosbox_args:e}},n.mountZip=function(e,t,n){return{files:[{drive:e,mountpoint:"/"+e,file:t,drive_type:n||"hdd"}]}},o.__proto__=n,i.__proto__=t,i.driver=function(e){return{mame_driver:e}},i.peripheral=function(e,t){var n={};return n[e]=[t],{peripheral:n}},i.keepAspect=function(e){return{keep_aspect:!!e}},i.extraArgs=function(e){return{extra_mame_args:e}},i.autoboot=function(e){return{autoboot:e}},r.__proto__=t,r.autoLoad=function(e){return{emulatorStart:e}},r.extraArgs=function(e){return{extra_vice_args:e}},r.fliplist=function(e){return{fliplist:e}},r._create_fliplist_file=function(e,t){var n="# Vice fliplist file\n\n";t.forEach(function(e,t){e&&(e=e.reverse(),n+="UNIT "+(t+8).toString()+"\n",e.forEach(function(e){n+="/emulator/"+e+"\n"}))}),e.push(r.mountFile("/metadata_fliplist.vfl",r.localFile("Fliplist",n)).files[0])},a.__proto__=t,a.model=function(e){return{amigaModel:e}},a.fastMemory=function(e){return{fast_memory:e<<20}},a.rom=function(e){return"string"==typeof e&&(e=[e]),{rom:e[0],extRom:e[1]}},a.floppy=function(e,t){var n={};return n[e]=t,{floppy:n}},a.ntsc=function(e){return{ntsc:!!e}},l.__proto__=t,l.model=function(e){return{pceModel:e}},l.extraArgs=function(e){return{extra_pce_args:e}},s.__proto__=t,s.autoLoad=function(e){return{emulatorStart:e}},s.extraArgs=function(e){return{extra_np2_args:e}};var u=function(e,t,n,o,i,r,a,l,s){s=s||1;var u=[t,"-rompath","emulator","-window",l?"-keepaspect":"-nokeepaspect"];if(n&&"width"in n&&"height"in n&&u.push("-resolution",[n.width*s,n.height*s].join("x")),o&&u.push("-samplerate",o),r&&u.push("-autoboot_command",r+"\\n","-autoboot_delay","2"),a&&(u=u.concat(a)),i)for(var c in i)Object.prototype.propertyIsEnumerable.call(i,c)&&u.push("-"+c,"/emulator/"+i[c][0].replace(/\//g,"_"));return u},c=function(e,t,n){for(var o=["-conf","/emulator/dosbox.conf"],i=t.length,r=0;r<i;r++)"drive"in t[r]&&("hdd"===t[r].drive_type?o.push("-c","mount "+t[r].drive+" /emulator"+t[r].mountpoint):"floppy"===t[r].drive_type?o.push("-c","mount "+t[r].drive+" /emulator"+t[r].mountpoint+" -t floppy"):"cdrom"===t[r].drive_type&&o.push("-c","mount "+t[r].drive+" /emulator"+t[r].mountpoint+" -t cdrom"));n&&(o=o.concat(n));var a=e.split(/\\|\//);o.push("-c",/^[a-zA-Z]:$/.test(a[0])?a.shift():"c:");var l=a.pop();return a&&a.length&&o.push("-c","cd "+a.join("/")),o.push("-c",l),o},f=function(e,t,n,o){var i=e?["-autostart","/emulator/"+e]:[];return(n[0]||n[1]||n[2]||n[3])&&(i=i.concat(["-flipname","/emulator/metadata_fliplist.vfl"])),o&&(i=i.concat(o)),i},d=function(e,t,n){var o=e?[e]:[];return n&&(o=o.concat(n)),o};function m(e,t){var n=this;this._canvas=e,this._hooks={start:[],reset:[]},Module={arguments:t.emulator_arguments,screenIsReadOnly:!0,print:function(e){console.log(e)},printErr:function(e){console.log(e)},canvas:e,noInitialRun:!1,locateFile:t.locateAdditionalJS,wasmBinary:t.wasmBinary,preInit:function(){BrowserFS.initialize(t.fs);var e=new BrowserFS.EmscriptenFS;FS.mkdir("/emulator"),FS.mount(e,{root:"/"},"/emulator")},preRun:[function(){n._hooks.start.forEach(function(e){e&&e()})}]}}function p(){return m.apply(this,arguments)}function h(){return m.apply(this,arguments)}function g(){return m.apply(this,arguments)}function _(e,t){this._sae=new ScriptedAmigaEmulator,this._cfg=this._sae.getConfig(),this._canvas=e;var n=null;switch(t.amigaModel){case"A500":n=SAEC_Model_A500;break;case"A500P":n=SAEC_Model_A500P;break;case"A600":n=SAEC_Model_A600;break;case"A1000":n=SAEC_Model_A1000;break;case"A1200":n=SAEC_Model_A1200;break;case"A2000":n=SAEC_Model_A2000;break;case"A3000":n=SAEC_Model_A3000;break;case"A4000":n=SAEC_Model_A4000;break;case"A4000T":n=SAEC_Model_A4000T}this._sae.setModel(n,0),this._cfg.memory.z2FastSize=t.fastMemory||2<<20,this._cfg.floppy.speed=SAEC_Config_Floppy_Speed_Turbo,this._cfg.video.id=e.getAttribute("id"),t.nativeResolution&&360==t.nativeResolution.height&&284==t.nativeResolution.width?(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_LoRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_NonDouble,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT):t.nativeResolution&&1440==t.nativeResolution.height&&568==t.nativeResolution.width?(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_SuperHiRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_Double,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<2,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1):(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_HiRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_Double,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<1,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1),this._cfg.memory.rom.name=t.rom,this._cfg.memory.rom.data=t.fs.readFileSync("/"+t.rom,null,S),this._cfg.memory.rom.size=this._cfg.memory.rom.data.length,t.extRom&&(this._cfg.memory.extRom.name=t.extRom,this._cfg.memory.extRom.data=t.fs.readFileSync("/"+t.extRom,null,S),this._cfg.memory.extRom.size=this._cfg.memory.extRom.data.length);for(var o=0;o<Object.keys(t.floppy).length;o++)this._cfg.floppy.drive[o].file.name=t.floppy[o],this._cfg.floppy.drive[o].file.data=t.fs.readFileSync("/"+t.floppy[o],null,S),this._cfg.floppy.drive[o].file.size=this._cfg.floppy.drive[o].file.data.length}function v(t,n,o){"object"!=typeof n&&(n={before_emulator:null,before_run:n});var i,r,a,l,s=!1,u={foreground:"white",background:"black",failure:"red"},c={loading_text:"",spinning:!0,finished_loading:!1,colors:u,table:null,splashimg:new Image},f=!1;if(this.isMuted=function(){return f},this.mute=function(){return this.setMute(!0)},this.unmute=function(){return this.setMute(!1)},this.toggleMute=function(){return this.setMute(!f)},this.setMute=function(e){if(f=e,i)e?i.mute():i.unmute();else try{r||(r=Module.cwrap("SDL_PauseAudio","",["number"])),r(e)}catch(e){console.log("Unable to change audio state:",e)}return this},window.addEventListener("gamepadconnected",function(e){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length)}),window.addEventListener("gamepaddisconnected",function(e){console.log("Gamepad disconnected from index %d: %s",e.gamepad.index,e.gamepad.id)}),!t.hasAttribute("width")){var d=getComputedStyle(t);t.width=parseInt(d.width,10),t.height=parseInt(d.height,10)}this.setScale=function(e){return console.warn("setScale method is deprecated; use the BaseLoader.scale method instead"),this},this.setSplashImage=function(e){return e&&(e instanceof Image?c.splashimg.parentNode?c.splashimg.src=e.src:c.splashimg=e:c.splashimg.src=e),this},this.setCSSResolution=function(e){return a=e,this},this.setAspectRatio=function(e){return l=e,this},this.setCallbacks=function(e){return n="object"!=typeof e?{before_emulator:null,before_run:e}:e,this},this.setSplashColors=function(e){return c.colors=e,this},this.setLoad=function(e){return o=e,this};this.start=function(r){if(s)return!1;s=!0;var u,d,p,_={waitAfterDownloading:!1,hasCustomCSS:!1};function y(){var e=new p.runner(t,p);return g(t,p.scale,p.nativeResolution,p.aspectRatio),e.onStarted(function(){c.finished_loading=!0,c.hide(),setTimeout(function(){f&&e.mute(),n&&n.before_run&&n.before_run()},0)}),e.onReset(function(){f&&e.mute()}),e}return"object"!=typeof r?r=_:r.__proto__=_,function(e,t,n){t.splashElt=document.getElementById("emularity-splash-screen"),t.splashElt||(t.splashElt=document.createElement("div"),t.splashElt.classList.add("emularity-splash-screen"),n.hasCustomCSS||(t.splashElt.style.position="absolute",t.splashElt.style.top="0",t.splashElt.style.left="0",t.splashElt.style.right="0",t.splashElt.style.color=t.getColor("foreground"),t.splashElt.style.backgroundColor=t.getColor("background")),e.parentElement.appendChild(t.splashElt)),t.splashimg.classList.add("emularity-splash-image"),n.hasCustomCSS||(t.splashimg.style.display="block",t.splashimg.style.marginLeft="auto",t.splashimg.style.marginRight="auto"),t.splashElt.appendChild(t.splashimg),t.titleElt=document.createElement("span"),t.titleElt.classList.add("emularity-splash-title"),n.hasCustomCSS||(t.titleElt.style.display="block",t.titleElt.style.width="100%",t.titleElt.style.marginTop="1em",t.titleElt.style.marginBottom="1em",t.titleElt.style.textAlign="center",t.titleElt.style.font="24px sans-serif"),t.titleElt.textContent=" ",t.splashElt.appendChild(t.titleElt);var o=document.getElementById("emularity-progress-indicator");o||((o=document.createElement("table")).classList.add("emularity-progress-indicator"),o.dataset.hasCustomCSS=n.hasCustomCSS,n.hasCustomCSS||(o.style.width="75%",o.style.color=t.getColor("foreground"),o.style.backgroundColor=t.getColor("background"),o.style.marginLeft="auto",o.style.marginRight="auto",o.style.borderCollapse="separate",o.style.borderSpacing="2px"),t.splashElt.appendChild(o)),t.table=o}(t,c,r),v(),("function"==typeof o?o(h,c):e.resolve(o)).then(function(t){return new e(function(n,o){var i=new BrowserFS.FileSystem.InMemory;if(BrowserFS.FileSystem.IndexedDB.isAvailable()){var r=BrowserFS.FileSystem.AsyncMirror,a=BrowserFS.FileSystem.IndexedDB;deltaFS=new r(i,new a(function(e,t){e?(deltaFS=i,l()):deltaFS.initialize(function(e){e?o(e):l()})},"fileSystemKey"in t?t.fileSystemKey:"emularity"))}else l();function l(){(p=t).fs=new BrowserFS.FileSystem.OverlayFS(deltaFS,new BrowserFS.FileSystem.MountableFileSystem),p.fs.initialize(function(t){if(t)console.error("Failed to initialize the OverlayFS:",t),o();else{var i=BrowserFS.BFSRequire("buffer").Buffer;function r(t){return"data"in t&&null!==t.data&&void 0!==t.data?e.resolve(t.data):h(t.title,t.url,"arraybuffer",t.optional)}function a(e){return function(t){if(null!==t){var n="/"+(e=e.toLowerCase());p.fs.getOverlayedFileSystems().readable.mount(n,(o=new i(t),new BrowserFS.FileSystem.ZipFS(o)))}var o}}var l=p.files.map(function(e){if(e&&e.file){if(e.drive)return r(e.file).then(a(e.drive));if(e.mountpoint)return r(e.file).then((t=e.mountpoint,function(e){if(null!==e){if(t.includes("/"))for(var n=t.split("/"),o=1;o<n.length;o++){var r="/"+n.slice(0,o).join("/");p.fs.existsSync(r)||p.fs.mkdirSync(r)}p.fs.writeFileSync("/"+t,new i(e),null,E,420)}}))}var t;return null});"emulatorWASM"in p&&p.emulatorWASM&&"WebAssembly"in window&&l.push(r({title:"WASM Binary",url:p.emulatorWASM}).then(function(e){p.wasmBinary=e})),e.all(l).then(n,o)}})}})}).then(function(n){return!p||c.failed_loading?null:r.waitAfterDownloading?new e(function(e,n){c.setTitle("Press any key to continue..."),c.spinning=!1,window.addEventListener("keypress",u=function(e){return function(t){32==t.which&&(t.preventDefault(),e())}}(e)),t.addEventListener("click",d=e),c.splashElt.addEventListener("click",d)}):e.resolve()},function(){c.failed_loading||(c.setTitle("Failed to download game data!"),c.failed_loading=!0)}).then(function(){if(!p||c.failed_loading)return null;var o,r,s,f;if(c.spinning=!0,window.removeEventListener("keypress",u),t.removeEventListener("click",d),c.splashElt.removeEventListener("click",d),window.onkeydown=function(e){return!(e.which>=33&&e.which<=40&&(e.preventDefault(),1))},o=function(){document.mozFullScreenElement||document.fullScreenElement||g(t,scale,a,l)},"onfullscreenchange"in document?document.addEventListener("fullscreenchange",o):"onmozfullscreenchange"in document?document.addEventListener("mozfullscreenchange",o):"onwebkitfullscreenchange"in document&&document.addEventListener("webkitfullscreenchange",o),t.addEventListener("contextmenu",function(e){2==e.button&&e.preventDefault()}),t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,s=p.fs,f=null,function e(t){s.readdirSync(t).forEach(function(n){if(!f&&"."!==n&&".."!==n){var o=t+("/"!==t[t.length-1]?"/":"")+n,i=s.statSync(o);i.isDirectory(i.mode)?e(o):"dosbox.conf"===n&&(f=o)}})}("/"),null!==f&&s.writeFileSync("/dosbox.conf",s.readFileSync(f,null,S),null,E,420),n&&n.before_emulator)try{n.before_emulator()}catch(e){console.log(e)}return"runner"in p&&(p.runner==m||p.runner.prototype instanceof m)&&(i=y()),p.emulatorJS?(c.setTitle("Launching Emulator"),r=p.emulatorJS,new e(function(e,t){var n;function o(t){t.target==n&&(n.removeEventListener("load",o),n.removeEventListener("error",i),e())}function i(e){e.target==n&&(n.removeEventListener("load",o),n.removeEventListener("error",i),t())}if(r){var a=document.getElementsByTagName("head")[0];(n=document.createElement("script")).addEventListener("load",o),n.addEventListener("error",i),n.type="text/javascript",n.src=r,a.appendChild(n)}})):(c.setTitle("Non-system disk or disk error"),null)},function(){if(!p||c.failed_loading)return null;c.setTitle("Invalid media, track 0 bad or unusable"),c.failed_loading=!0}).then(function(){if(!p||c.failed_loading)return null;"runner"in p&&(i||(i=y()),i.start())}),this};var p=function(e,t){if(0===e)return"0 B";var n=t?1e3:1024,o=t?["B","kB","MB","GB","TB","PB","EB","ZB","YB"]:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=parseInt(Math.log(e)/Math.log(n));return(e/Math.pow(n,i)).toFixed(1)+" "+o[i]},h=function(t,n,o,i){var r="false"==c.table.dataset.hasCustomCSS,a=_(c.table),l=a[0],s=a[1];return l.textContent=t,new e(function(e,a){var u=new XMLHttpRequest;function f(){s.textContent="✔",l.parentNode.classList.add("emularity-download-success"),l.textContent=t,r&&(l.style.fontWeight="bold",l.parentNode.style.backgroundColor=c.getColor("foreground"),l.parentNode.style.color=c.getColor("background"))}function d(){s.textContent="✘",l.parentNode.classList.add("emularity-download-failure"),l.textContent=t,r&&(l.style.fontWeight="bold",l.parentNode.style.backgroundColor=c.getColor("failure"),l.parentNode.style.color=c.getColor("background"))}u.open("GET",n,!0),u.responseType=o||"arraybuffer",u.onprogress=function(e){var n;l.innerHTML=t+' <span style="font-size: smaller">'+((n=e).lengthComputable?"("+(n.total?(n.loaded/n.total*100).toFixed(0):"100")+"%; "+p(n.loaded)+" of "+p(n.total)+")":"("+p(n.loaded)+")")+"</span>"},u.onload=function(t){200===u.status?(f(),e(u.response)):i?(f(),e(null)):(d(),a())},u.onerror=function(t){i?(f(),e(null)):(d(),a())},u.send()})};var g=function(e,t,n,o){t&&n&&(e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated",e.style.imageRendering="optimizeSpeed",e.style.width=n.width*t+"px",e.style.height=n.height*t+"px",e.setAttribute("width",n.width*t),e.setAttribute("height",n.height*t))};c.setTitle=function(e){c.titleElt.textContent=e},c.hide=function(){c.splashElt.style.display="none"},c.getColor=function(e){return e in c.colors?c.colors[e]:u[e]};var _=function(e){var t="false"==e.dataset.hasCustomCSS,n=e.insertRow(-1);t&&(n.style.textAlign="center");var o=n.insertCell(-1);t&&(o.style.position="relative");var i=document.createElement("span");i.classList.add("emularity-download-title"),i.textContent="—",t&&(i.style.verticalAlign="center",i.style.minHeight="24px",i.style.whiteSpace="nowrap"),o.appendChild(i);var r=document.createElement("span");return r.classList.add("emularity-download-status"),t&&(r.style.position="absolute",r.style.left="0",r.style.paddingLeft="0.5em"),o.appendChild(r),[i,r]},v=function(){t.setAttribute("moz-opaque",""),c.splashimg.src||(c.splashimg.src="logo/emularity_color_small.png")};this.isfullscreensupported=function(){return!!y()},this.requestFullScreen=function(){i&&i.requestFullScreen()}}function y(){return canvas.requestFullScreen||canvas.webkitRequestFullScreen||canvas.mozRequestFullScreen}m.prototype.start=function(){},m.prototype.pause=function(){},m.prototype.stop=function(){},m.prototype.mute=function(){try{SDL_PauseAudio||(SDL_PauseAudio=Module.cwrap("SDL_PauseAudio","",["number"])),SDL_PauseAudio(!0)}catch(e){console.log("Unable to change audio state:",e)}},m.prototype.unmute=function(){try{SDL_PauseAudio||(SDL_PauseAudio=Module.cwrap("SDL_PauseAudio","",["number"])),SDL_PauseAudio(!1)}catch(e){console.log("Unable to change audio state:",e)}},m.prototype.onStarted=function(e){this._hooks.start.push(e)},m.prototype.onReset=function(e){this._hooks.reset.push(e)},m.prototype.requestFullScreen=function(){this._canvas.requestFullscreen()},p.prototype=Object.create(m.prototype),p.prototype.start=function(){FS.symlink("/emulator/y/FONT.ROM","/FONT.ROM"),FS.symlink("/emulator/y/2608_bd.wav","/2608_bd.wav"),FS.symlink("/emulator/y/2608_hh.wav","/2608_hh.wav"),FS.symlink("/emulator/y/2608_sd.wav","/2608_sd.wav"),FS.symlink("/emulator/y/2608_rim.wav","/2608_rim.wav"),FS.symlink("/emulator/y/2608_tom.wav","/2608_tom.wav"),FS.symlink("/emulator/y/2608_top.wav","/2608_top.wav")},h.prototype=Object.create(m.prototype),h.prototype.start=function(){try{var e=FS.readFile("/emulator/np2.cfg");FS.writeFile("/emulator/np2/np2.cfg",e)}catch(e){console.log(e)}},g.prototype=Object.create(m.prototype,{mute:{value:function(){var e=Module.__ZN15running_machine30emscripten_get_running_machineEv(),t=Module.__ZN15running_machine20emscripten_get_soundEv(e);Module.__ZN13sound_manager4muteEbh(t,!0,2)}},unmute:{value:function(){var e=Module.__ZN15running_machine30emscripten_get_running_machineEv(),t=Module.__ZN15running_machine20emscripten_get_soundEv(e);Module.__ZN13sound_manager4muteEbh(t,!1,2)}}}),_.prototype.start=function(){this._sae.start()},_.prototype.pause=function(){this._sae.pause()},_.prototype.stop=function(){this._sae.stop()},_.prototype.mute=function(){var e=this._sae.mute(!0);e&&console.warn("unable to mute; SAE error number",e)},_.prototype.unmute=function(){var e=this._sae.mute(!1);e&&console.warn("unable to unmute; SAE error number",e)},_.prototype.onStarted=function(e){this._cfg.hook.event.started=e},_.prototype.onReset=function(e){this._cfg.hook.event.reseted=e},_.prototype.requestFullScreen=function(){y().call(this._canvas)};var S={isReadable:function(){return!0},isWriteable:function(){return!1},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 1}},E={isReadable:function(){return!1},isWriteable:function(){return!0},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 3}};function w(e,t){if(null===e)return t;if(null===t)return e;var n=typeof e,o=typeof t;if(n!==o){if("undefined"===n)return t;if("undefined"===o)return e;throw new Error("Cannot extend an "+n+" with an "+o)}return Array.isArray(e)?e.concat(t):"object"===n?(Object.keys(t).forEach(function(n){e[n]=w(n in e?e[n]:void 0,t[n])}),e):t}function b(e){e instanceof XMLDocument&&(e=e.documentElement);var t,n={},o=e.childNodes.length;for(t=0;t<o;t++){var i=e.childNodes[t];n[i.nodeName]=i.textContent}return n}function x(e){return function(e){return e instanceof XMLDocument&&(e=e.documentElement),Array.prototype.slice.call(e.childNodes)}(e).filter(function(e){return"getAttribute"in e}).map(function(e){var t=b(e);return t.name=e.getAttribute("name"),t})}function A(e,t){return t?(t.startsWith(".")||(t="."+t),t=t.toLowerCase(),x(e).filter(function(e){return e.name.toLowerCase().endsWith(t)})):[]}function F(e,t){return"string"==typeof t&&(t=RegExp(t)),Object.keys(e).map(function(e){var n=t.exec(e);return n?[e,n]:null}).filter(function(e){return!!e})}window.IALoader=function(t,o,u,c){if("string"!=typeof o&&(o=o.toString()),u&&"object"==typeof u)if("function"==typeof u.before_emulator){var f=u.before_emulator;u.before_emulator=function(){p(),f()}}else u.before_emulator=p;else u={before_emulator:p,before_run:u};function d(e){var t=new Image;return t.src=e,t}var m;function p(){x&&M.setSplashImage(x)}m=/archive\.org$/.test(document.location.hostname)?{ia:d("/images/ialogo.png"),mame:d("/images/mame.png"),mess:d("/images/mame.png"),dosbox:d("/images/dosbox.png"),sae:d("/images/sae.png"),pce:d("/images/pce.png"),vice:d("/images/vice.svg"),np2:d("/images/nekop2.gif"),xmil:d("/images/xmillenium_logo.jpg"),vmac:d("/images/vmac.png")}:{ia:d("other_logos/ia-logo-150x150.png"),mame:d("other_logos/mame.png"),mess:d("other_logos/mame.png"),dosbox:d("other_logos/dosbox.png"),sae:d("other_logos/sae.png"),pce:d("other_logos/pce.png"),vice:d("other_logos/vice.svg"),np2:d("other_logos/nekop2.gif"),xmil:d("other_logos/xmillenium_logo.jpg"),vmac:d("other_logos/vmac.png")};var h,g,_,y,S,E,x,C,k=!!(h=window.AudioContext||window.webkitAudioContext||!1)&&(new h).sampleRate.toString(),M=new v(t).setSplashImage(m.ia).setLoad(function(t,u){return u.setTitle("Downloading game metadata..."),new e(function(f,d){t("Game Metadata",W(o),"document").then(function(e){return g=e,u.setTitle("Downloading game filelist..."),t("Game File List",H(o),"document",!0)},function(){u.setTitle("Failed to download IA item metadata!"),u.failed_loading=!0,d(1)}).then(function(e){return u.failed_loading?null:(_=e,u.setTitle("Downloading emulator metadata..."),y=g.getElementsByTagName("emulator").item(0).textContent,t("Emulator Metadata",j(y),"text",!0))},function(){u.failed_loading||(u.setTitle("Failed to download file list!"),u.failed_loading=!0,d(2))}).then(function(t){if(u.failed_loading)return null;var f;if(S=JSON.parse(t),y&&0===y.indexOf("dosbox"))x=m.dosbox,C=n,f=R;else if(y&&0===y.indexOf("sae-"))x=m.sae,C=a,f=T;else if(y&&0===y.indexOf("pce-"))x=m.pce,C=l,f=D;else if(y&&0===y.indexOf("vice"))x=m.vice,C=r,f=B;else if(y&&0===y.indexOf("np2-"))x=m.np2,C=s,f=I;else if(y&&0===y.indexOf("xmil-"))x=m.xmil,C=s,f=z;else if(y&&0===y.indexOf("vmac-"))x=m.vmac,C=s,f=N;else{if(!y)throw new Error("Unknown module type "+y+"; cannot configure the emulator.");x=m.mame,C=i,f=O}var d=S.wasm_filename&&"WebAssembly"in window,p=S.native_resolution;E=[C.emulatorJS(V(d?S.wasmjs_filename:S.js_filename)),C.emulatorWASM(d&&V(S.wasm_filename)),C.locateAdditionalEmulatorJS(L),C.fileSystemKey(o),C.nativeResolution(p[0],p[1]),C.aspectRatio(p[0]/p[1]),C.scale(c||S.scale||2),C.sampleRate(k)],"keepAspect"in C&&E.push(C.keepAspect(S.keepAspect)),/archive\.org$/.test(document.location.hostname)&&E.push(C.muted(!("undefined"!=typeof $&&$.cookie&&$.cookie("unmute"))));var h=g.getElementsByTagName("emulator_start").item(0);if(y&&0===y.indexOf("dosbox"))E.push(C.startExe(g.getElementsByTagName("emulator_start").item(0).textContent));else if(y&&0===y.indexOf("vice")){var v=[g.getElementsByTagName("vice_drive_8_fliplist").item(0),g.getElementsByTagName("vice_drive_9_fliplist").item(0),g.getElementsByTagName("vice_drive_10_fliplist").item(0),g.getElementsByTagName("vice_drive_11_fliplist").item(0)];h&&E.push(C.autoLoad(h.textContent));var w=[];v.forEach(function(e){e?w.push(e.textContent.split(";")):w.push(null)}),E.push(C.fliplist(w)),E.push(C.extraArgs(S.extra_args))}else if(y&&0===y.indexOf("sae-"))E.push(C.model(S.driver),C.rom(S.bios_filenames));else if(!y||0!=y.indexOf("np2-")&&0!=y.indexOf("xmil-")&&0!=y.indexOf("vmac-"))y&&0===y.indexOf("pce-")?E.push(C.model(S.driver),C.extraArgs(S.extra_args)):y&&(E.push(C.driver(S.driver),C.extraArgs(S.extra_args)),h&&E.push(C.autoboot(h.textContent)));else{if(!h)throw new Exception("Error: this item does not have an 'emulator_start' metadata value; I don't know what to run.");E.push(C.autoLoad("/emulator/"+h.textContent),C.extraArgs(S.extra_args))}return u.setTitle("Downloading game data..."),e.all(f(C,g,S,_))},function(){u.failed_loading||(u.setTitle("Failed to download emulator metadata!"),u.failed_loading=!0,d(2))}).then(function(e){u.failed_loading||(p(),f(C.apply(null,w(E,e))))},function(e){u.failed_loading||(u.setTitle("Failed to configure emulator!"),u.failed_loading=!0,d(3))})})}).setCallbacks(u);function L(e){return"file_locations"in S&&e in S.file_locations?V(S.file_locations[e]):V(e)}function R(e,t,n,i){var r={},a=[],l=b(t);o&&o.endsWith(".zip")&&(r.c=o),A(i,l.emulator_ext).forEach(function(e,t){r.c=e.name}),F(l,/^dosbox_drive_([a-zA-Z])$/).forEach(function(e){var t=e[0],n=e[1];r[n[1]]=l[t]});var s=Object.keys(r),u=s.length;return s.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+u+")",l=r[t],s=l.includes("/")?Z(l):Z(l,P(o));l.toLowerCase().endsWith(".zip")?a.push(e.mountZip(t,e.fetchFile(i,s))):a.push(e.mountFile("/"+l,e.fetchFile(i,s)))}),a}function B(e,t,n,i){var r={},a=[],l=[],s=b(t);A(i,s.emulator_ext).forEach(function(e,t){l.push(e.name)}),A(i,"conf").forEach(function(e,t){l.push(e.name)}),F(s,/^vice_drive_([89])$/).forEach(function(e){var t=e[0],n=e[1];r[n[1]]=s[t]});var u=l.length;return l.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+u+")",r=t,l=r.includes("/")?Z(r):Z(r,P(o));r.toLowerCase().endsWith(".zip"),a.push(e.mountFile("/"+r,e.fetchFile(i,l)))}),a}function O(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="Bios File ("+(n+1)+" of "+a.length+")";r.push(e.mountFile("/"+t,e.fetchFile(o,q(t))))}});var l=b(t),s={},u={};A(i,l.emulator_ext).forEach(function(e,t){u[e.name]=1,n.peripherals&&n.peripherals[t]&&(s[n.peripherals[t]]=e.name)}),F(l,/^mame_peripheral_([a-zA-Z0-9]+)$/).forEach(function(e){var t=e[0],n=e[1];s[n[1]]=l[t],u[l[t]]=1});var c=Object.keys(u),f=c.length;return c.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+f+")",a=t.includes("/")?Z(t):Z(t,P(o));r.push(e.mountFile("/"+t,e.fetchFile(i,a)))}),Object.keys(s).forEach(function(t){r.push(e.peripheral(t,s[t]))}),r.push(e.mountFile("/"+n.driver+".cfg",e.fetchOptionalFile("CFG File",G(y)))),r}function T(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="Bios File ("+(n+1)+" of "+a.length+")";r.push(e.mountFile("/"+t,e.fetchFile(o,q(t))))}});var l=A(i,b(t).emulator_ext);return l.forEach(function(t,n){if(t){var i="Game File ("+(n+1)+" of "+l.length+")",a=t.name.includes("/")?Z(t.name):Z(t.name,P(o));r.push(e.mountFile("/"+t.name,e.fetchFile(i,a))),r.push(e.floppy(0,t.name))}}),r.push(e.mountFile("/"+n.driver+".cfg",e.fetchOptionalFile("Config File",G(y)))),r}function D(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="ROM File ("+(n+1)+" of "+a.length+")";r.push(e.mountFile("/"+t,e.fetchFile(o,q(t))))}});var l=b(t),s={};A(i,l.emulator_ext).forEach(function(e,t){n.peripherals&&n.peripherals[t]&&(s[e.name]=n.peripherals[t])}),F(l,/^pce_drive_([a-zA-Z0-9]+)$/).forEach(function(e){var t=e[0],n=e[1][1];s[l[t]]=n});var u=Object.keys(s),c=u.length;return u.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+c+")",a=t.match(/\.([^.]*)$/)[1],l=t.includes("/")?Z(t):Z(t,P(o));r.push(e.mountFile("/"+s[t]+"."+a,e.fetchFile(i,l)))}),r.push(e.mountFile("/pce-"+n.driver+".cfg",e.fetchOptionalFile("Config File",G("pce-"+n.driver)))),r}function I(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="ROM File ("+(n+1)+" of "+a.length+")",i=t.endsWith(".zip")?e.mountZip:e.mountFile;r.push(i("np2",e.fetchFile(o,q(t))))}});var l=b(t),s={};A(i,l.emulator_ext).forEach(function(e,t){s[e.name]=1});var u=Object.keys(s),c=u.length;return u.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+c+")",a=t.includes("/")?Z(t):Z(t,P(o));r.push(e.mountFile("/"+t,e.fetchFile(i,a)))}),r}function z(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="ROM File ("+(n+1)+" of "+a.length+")",i=t.endsWith(".zip")?e.mountZip:e.mountFile;r.push(i("xmil",e.fetchFile(o,q(t))))}});var l=b(t),s={};A(i,l.emulator_ext).forEach(function(e,t){s[e.name]=1});var u=Object.keys(s),c=u.length;return u.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+c+")",a=t.includes("/")?Z(t):Z(t,P(o));r.push(e.mountFile("/"+t,e.fetchFile(i,a)))}),r}function N(e,t,n,i){var r=[],a=n.bios_filenames;a.forEach(function(t,n){if(t){var o="ROM File ("+(n+1)+" of "+a.length+")",i=t.endsWith(".zip")?e.mountZip:e.mountFile;r.push(i("minivmac",e.fetchFile(o,q(t))))}});var l=b(t),s={};A(i,l.emulator_ext).forEach(function(e,t){s[e.name]=1});var u=Object.keys(s),c=u.length;return u.forEach(function(t,n){var i="Game File ("+(n+1)+" of "+c+")",a=t.includes("/")?Z(t):Z(t,P(o));r.push(e.mountFile("/"+t,e.fetchFile(i,a)))}),r}var P=function(e){return e.split("/").shift()},j=function(e){return"//cors.archive.org/cors/emularity_engine_v1/"+e+".json"},G=function(e){return"//cors.archive.org/cors/emularity_config_v1/"+e+".cfg"},W=function(e){var t=e.split("/");return"//cors.archive.org/cors/"+t[0]+"/"+t[0]+"_meta.xml"},H=function(e){var t=e.split("/");return"//cors.archive.org/cors/"+t[0]+"/"+t[0]+"_files.xml"},Z=function(e,t){return t?"//cors.archive.org/cors/"+t+"/"+e:"//cors.archive.org/cors/"+e},V=function(e){return"//cors.archive.org/cors/emularity_engine_v1/"+e},q=function(e){return"//cors.archive.org/cors/emularity_bios_v1/"+e};return M},window.DosBoxLoader=n,window.PC98DosBoxLoader=o,window.JSMESSLoader=i,window.JSMAMELoader=i,window.MAMELoader=i,window.SAELoader=a,window.PCELoader=l,window.VICELoader=r,window.NP2Loader=s,window.Emulator=v,window._SDL_CreateRGBSurfaceFrom=function(e,t,n,o,i,r,a,l,s){for(var u=SDL.makeSurface(t,n,0,!1,"CreateRGBSurfaceFrom",r,a,l,s),c=SDL.surfaces[u],f=c.ctx.getImageData(0,0,t,n),d=f.data,m=s?4:3,p=0;p<t*n;p++)d[4*p+0]=HEAPU8[e+(p*m+0)],d[4*p+1]=HEAPU8[e+(p*m+1)],d[4*p+2]=HEAPU8[e+(p*m+2)],d[4*p+3]=s?HEAPU8[e+(p*m+3)]:255;return c.ctx.putImageData(f,0,0),u}}("undefined"==typeof Promise?ES6Promise.Promise:Promise);var JSMESS=JSMESS||{};JSMESS.ready=function(e){e()};